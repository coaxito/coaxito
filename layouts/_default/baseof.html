<!DOCTYPE html>
<html lang="{{ site.LanguageCode | default " pt-br" }}">

<head>
  <script>
    // Aplica tema inicial (light/dark/ecologic/cherry) o mais cedo possível
    (function() {
      const LSTORAGE_KEY = 'color-theme'; // Mesma chave do theme-toggle.js
      // Nomes dos temas (Strings)
      const THEME_LIGHT = 'light';
      const THEME_DARK = 'dark';
      const THEME_ECOLOGIC = 'ecologic';
      const THEME_CHERRY = 'cherry';
      // Nomes das classes CSS
      const CLASS_LIGHT = 'light';
      const CLASS_DARK = 'dark';
      const CLASS_ECOLOGIC = 'ecologic';
      const CLASS_CHERRY = 'cherry';

      let theme = THEME_LIGHT; // Default para light

      try {
        const stored = localStorage.getItem(LSTORAGE_KEY);
        // Verifica se o tema salvo é um dos quatro válidos //
        if ([THEME_LIGHT, THEME_DARK, THEME_ECOLOGIC, THEME_CHERRY].includes(stored)) {
          theme = stored; // Usa tema salvo se existir
        } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          theme = THEME_DARK; // Senão, usa preferência do dispositivo (apenas para dark)
        }
      } catch (e) { /* Ignora erros de localStorage/matchMedia */ }

       if (theme === THEME_DARK) {
        if (!document.documentElement.classList.contains(CLASS_DARK)) document.documentElement.classList.add(CLASS_DARK);
        document.documentElement.classList.remove(CLASS_LIGHT, CLASS_ECOLOGIC, CLASS_CHERRY);
      } else if (theme === THEME_ECOLOGIC) {
        if (!document.documentElement.classList.contains(CLASS_ECOLOGIC)) document.documentElement.classList.add(CLASS_ECOLOGIC);
        document.documentElement.classList.remove(CLASS_LIGHT, CLASS_DARK, CLASS_CHERRY);
      } else if (theme === THEME_CHERRY) {
         if (!document.documentElement.classList.contains(CLASS_CHERRY)) document.documentElement.classList.add(CLASS_CHERRY);
         document.documentElement.classList.remove(CLASS_LIGHT, CLASS_DARK, CLASS_ECOLOGIC);
      } else { // Tema é Light
        if (!document.documentElement.classList.contains(CLASS_LIGHT)) document.documentElement.classList.add(CLASS_LIGHT);
        document.documentElement.classList.remove(CLASS_DARK, CLASS_ECOLOGIC, CLASS_CHERRY);
      }
    })();
  </script>

  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>{{- block "title" . }}{{ with .Title }}{{ . }} | {{ end }}{{ .Site.Title }}{{- end }}</title>

  {{- partial "seo_tags.html" . -}}
  <meta name="referrer" content="no-referrer-when-downgrade" />

  {{/* CSS Principal - Carregado DEPOIS do script inicial */}}
  {{- partial "style.html" . -}}

  {{/* Conteúdo customizado da Head (Fontes, RSS, etc) */}}
  {{- partial "custom_head.html" . -}}

</head>

<body class="kind-{{ lower .Kind }}{{ with .Page.Params.bodyClass }} {{ . }}{{ end }}">

  <header>
    {{- partial "header.html" . -}}
  </header>
  <main>
    {{- block "main" . }}{{- end }}
  </main>
  <footer>
    {{- partial "footer.html" . -}}
  </footer>

  {{/* Conteúdo customizado antes do fim do body */}}
  {{- partial "custom_body.html" . -}}

  {{/* Script principal para troca de tema */}}
  <script defer src="{{ "/js/theme-toggle.js" | relURL }}"></script>

</body>
</html>
